name: "IOS App Workflow"

on:
  pull_request: 
  push:

jobs:
  setup:
    runs-on: macos-latest
    steps:
      - name: Checkout 
        uses: actions/checkout@v2
      - name: Install Yarn
        run: brew install yarn
      - name: Install Node Modules
        run: yarn install
      - name: Install Ruby
        run: brew install ruby
      - name: Install Cocoapods
        run: gem install cocoapods

      - name: Check Xcode Version
        run: xcodebuild -version
      - run: xcode-select -p
      - run: pod install
        working-directory: ios
        name: Install Pod dependencies
      - name: Run Tests
        run: yarn test
      - name: Build IOS 
        run: "xcodebuild \
        -workspace ios/ReactNativeSemaphoreNew.xcworkspace \
        -scheme ReactNativeSemaphoreNew \
        clean archive \
        -sdk iphoneos \
        -configuration release \
        -UseModernBuildSystem=NO \
        -archivePath $PWD/ReactNativeSemaphoreNew \
        -CODE_SIGNING_ALLOWED=NO"


      - name: Upload build artifacts
        uses: actions/upload-artifact@v2
        with:
          name: IOS artifact
          path: /Users/runner/Library/Developer/Xcode/DerivedData/ReactNativeSemaphoreNew-esatjbmkgsfjzgakujdszjsvlsyw/Build/Intermediates.noindex/ArchiveIntermediates/ReactNativeSemaphoreNew/BuildProductsPath/Release-iphoneos/ReactNativeSemaphoreNew.app.dSYM 
